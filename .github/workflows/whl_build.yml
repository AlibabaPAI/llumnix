name: whl_build

on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main

jobs:
  whl_build:
    runs-on: ubuntu-latest
    timeout-minutes: 1

    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Set up Python 
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"
    - name: Build whl
      run: |
        python3 -m pip install --upgrade setuptools wheel
        python3 setup.py bdist_wheel --universal
    - name: Create comment from file
      if: ${{ github.event_name != 'push' }}
      uses: actions/github-script@v7
      with:
        script: |
          try {
            const filePath = 'test.txt';
            console.log(`Attempting to read file: ${filePath}`);
            
            // Check if the file exists
            if (!fs.existsSync(filePath)) {
              throw new Error(`File not found: ${filePath}`);
            }
            
            const commentBody = fs.readFileSync(filePath, 'utf8');
            console.log('File read successfully, attempting to create comment...');
            
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: commentBody
            });
            
            console.log('Comment created successfully.');
          } catch (error) {
            console.log('Failed to create comment:', error.message);
          }